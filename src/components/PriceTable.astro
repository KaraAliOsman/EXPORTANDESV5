---
import priceData from "@/data/prices.json";
import { createWhatsAppLink, formatPrice, getTrendIcon } from "@/utils/whatsapp";
import { url } from "@/utils/paths";

const allItems = priceData.categories.flatMap((c) => c.items);
const featured = priceData.featured
  .map((id) => allItems.find((item) => item.id === id))
  .filter(Boolean) as typeof allItems;
---

<section class="relative bg-[#0a0a0a] py-20 sm:py-32 overflow-hidden">
  <div class="max-w-7xl mx-auto px-5 sm:px-8">
    <div class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4 mb-10 sm:mb-16">
      <div>
        <p class="text-xs font-medium tracking-[0.25em] uppercase text-white/40 mb-3">Precios</p>
        <h2 class="font-sans font-black text-3xl sm:text-5xl text-white leading-[1.05]">Tarifas por kilo</h2>
      </div>
      <a href={url("tarifas")} class="text-sm text-white/50 hover:text-white underline underline-offset-4 transition-colors">
        Ver lista completa &rarr;
      </a>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-px bg-white/10">
      {featured.map((item) => {
        const trend = getTrendIcon(item.trend);
        const waLink = createWhatsAppLink(item.name, "", "Concepcion");
        return (
          <div class="bg-[#0a0a0a] p-6 sm:p-8 group">
            <div class="flex items-center justify-between mb-6 sm:mb-8">
              <h3 class="text-sm font-semibold text-white/60 uppercase tracking-wide">{item.name}</h3>
              <span class:list={["text-xs font-medium", trend.color]}>{trend.icon} {trend.label}</span>
            </div>
            <p class="text-3xl sm:text-4xl font-black text-white tabular-nums mb-1">
              {formatPrice(item.price)}
            </p>
            <p class="text-xs text-white/30 mb-6">por kilogramo</p>
            <a
              href={waLink}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center gap-2 text-sm text-white/50 hover:text-white underline underline-offset-4 transition-colors"
            >
              Cotizar venta &rarr;
            </a>
          </div>
        );
      })}
    </div>

    <p class="mt-6 text-xs text-white/20">Actualizado: {priceData.lastUpdated}. Precios referenciales CLP.</p>
  </div>
</section>
